<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>D3 Test</title>
        <script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
        <link rel="stylesheet" type="text/css" href="css/primera.css">
        <link rel="stylesheet" type="text/css" href="css/estructura.css">
        <link rel="stylesheet" type="text/css" href="css/navbar.css">
        <script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
		<script src="js/script.js"></script>
    </head>
    <body>
    	<div id="cssmenu">
    		<ul id="nav_menu">
    			<li><a href="index.html"><span>Home</span></a></li>
				<li><a href="tutorial.html"><span>Tutorial</span></a></li>
				<li class="active"><a href="primera.html"><span>Primera</span></a></li>
				<li><a href="segunda.html"><span>Segunda</span></a></li>
				<li><a href="ultima.html"><span>Ultima</span></a></li>
				<li class="last"><a href="completo.html"><span>Com</span></a></li>
			</ul>
		</div>
		
		<!--<script>
			var w = 600;
		    var h = 400;
		    var padding = 40;
		    var formatBigNumbers = d3.format(".1s");
			var div = d3.select("body")
				.append("div")
				.attr("id","primero");
			var svg = div
				.append("svg")
				.attr("width", w)
		        .attr("height", h)
				.attr("class","graph")
				.attr("id","svg_p");
			
			d3.json("json/paisos.json", function(json) {
			    update(json);
			});
			
			function update(data){
				var svg = d3.select("#svg_p");
				
				var xScale = d3.scale.pow()
					.exponent(.10)
		        	.domain([0, d3.max(data, function(d) { 
		        		return +d.poblacion;
		        	})])
		        	.range([padding, w - padding]);
		    	var yScale = d3.scale.linear()
		            .domain([0, d3.max(data, function(d) { 
		            	return +d.riqueza; 
		            })])
		            .range([h-padding, padding]);
		    	var rScale = d3.scale.sqrt()
		            .domain([0, d3.max(data, function(d) { 
		            	return +d.poblacion; 
		            })])
		            .range([5, 20]);
		    	var xAxis = d3.svg.axis()
		        	.scale(xScale)
		        	.orient("bottom")
		        	.ticks(3)
		        	.tickFormat(formatBigNumbers)
			    var yAxis = d3.svg.axis()
	            	.scale(yScale)
	            	.orient("left")
	            	.ticks(5)
		    		.tickFormat(formatBigNumbers);
		    	var circles = svg.selectAll("circle")
				    .data(data)
				    .enter()
				    .append("circle")
				    .attr("fill",function(d){
				    	switch(d.continente){
				    		case "europa":
				    			return "red";
				    		case "america":
				    			return "green";
				    		case "asia":
				    			return "blue";
				    	}
				    })
				    .attr("cx", function(d) {
	    				return xScale(d.poblacion)-padding/2;
	    			})
					.attr("cy", function(d) {
					    return yScale(d.riqueza);
					})
					.attr("r", function(d) {
	    				return rScale(d.poblacion);
	    			});
		    	var texts = svg.selectAll("text")
				    .data(data)
				    .enter()
				    .append("text")
					.attr("x", function(d) {
	    				return xScale(d.poblacion)+padding/10;
					})
					.attr("y", function(d) {
	    				return yScale(d.riqueza)-padding/3;
	    			})
	    			.text(function(d) {
					    return d.nombre;
					})
					.attr("font-family", "sans-serif")
					.attr("font-size", "11px")
					.attr("fill", "black");

		    	svg
			    	.append("g")
			    	.attr("class", "axis")
			    	.attr("transform", "translate(0,"+(h-padding)+")")
			    	.call(xAxis);
			    svg
			    	.append("g")
			    	.attr("class", "axis")
			    	.attr("transform", "translate("+padding+",0)")
			    	.call(yAxis); 
  
			    svg
				    .append("text")
		            .attr("text-anchor", "middle")  // this makes it easy to centre the text as the transform is applied to the anchor
		            .attr("transform", "translate("+ (padding/4) +","+(h/2)+")rotate(-90)")  // text is drawn off the screen top left, move down and out and rotate
		            .attr("font-size", "10px")
		            .text("Riqueza");

		        svg
		        	.append("text")
		            .attr("text-anchor", "middle")  // this makes it easy to centre the text as the transform is applied to the anchor
		            .attr("transform", "translate("+((padding+w)/2)+","+(h-(padding/4))+")")  // centre below axis
		            .attr("font-size", "10px")
		            .text("Población");
			}
			
			var h_leyenda = h/2;
			
			var svg_leyenda = div
				.append("svg")
				.attr("width", w)
		        .attr("height", h_leyenda)
				.attr("class","leyenda");
			
			svg_leyenda
				.append("rect")
				.attr("x",padding)
				.attr("y",padding)
				.attr("width", 20)
			    .attr("height", 10)
    			.attr("fill", "blue");
			svg_leyenda
				.append("rect")
				.attr("x",padding)
				.attr("y",padding*2)
				.attr("width", 20)
			    .attr("height", 10)
				.attr("fill", "red");
			svg_leyenda
				.append("rect")
				.attr("x",padding)
				.attr("y",padding*3)
				.attr("width", 20)
			    .attr("height", 10)
				.attr("fill", "green");
			svg_leyenda
				.append("text")
				.attr("x", padding*2)
				.attr("y", padding+10)
		        .attr("font-size", "10px")
		        .text("Asia");
			svg_leyenda
				.append("text")
				.attr("x", padding*2)
				.attr("y", padding*2+10)
		        .attr("font-size", "10px")
		        .text("Europa");
			svg_leyenda
				.append("text")
				.attr("x", padding*2)
				.attr("y", padding*3+10)
		        .attr("font-size", "10px")
		        .text("America");
		</script>-->
		<button class="myButton">Update</button>
		<div id="segundo">
		</div>
		<script>
			var w = 600;
		    var h = 400;
		    var padding = 30;
			var i_circle,i_text,j_circle,j_text,i_year;
			var nElem = 10;
		    var formatBigNumbers = d3.format(".1s");
			var div = d3.select("#segundo");
			var svg = div
				.append("svg")
				.attr("width", w)
		        .attr("height", h)
				.attr("class","graph")
				.attr("id","svg_s");
			
			d3.json("json/paisos.temp.json", function(json) {
				draw(json);
			});
			
			function draw(data){
				
				var array = [];
				for(var i=0;i<data.length;i++){
					var array2 = [];
					for (var j=0;j<data[0].datos.length;j++){
						array2.push(parseInt(data[i].datos[j].riqueza));
					}
					array.push(d3.max(array2));	
				}
				
				var maxRiq = d3.max(array);
				
				var array = [];
				for(var i=0;i<data.length;i++){
					var array2 = [];
					for (var j=0;j<data[0].datos.length;j++){
						array2.push(parseInt(data[i].datos[j].poblacion));
					}
					array.push(d3.max(array2));
				}
				
				var maxPob = d3.max(array);
				
				var svg = d3.select("#svg_s");
				
				var xScale = d3.scale.pow()
					.exponent(.10)
		        	.domain([0, maxPob])
		        	.range([padding, w - padding]);
		    	var yScale = d3.scale.linear()
		            .domain([0, maxRiq])
		            .range([h-padding, padding]);
		    	var rScale = d3.scale.sqrt()
		            .domain([0, maxPob])
		            .range([5, 20]);
		    	var xAxis = d3.svg.axis()
		        	.scale(xScale)
		        	.orient("bottom")
		        	.ticks(3)
		        	.tickFormat(formatBigNumbers)
			    var yAxis = d3.svg.axis()
	            	.scale(yScale)
	            	.orient("left")
	            	.ticks(5)
		    		.tickFormat(formatBigNumbers);
		    	var circles = svg.selectAll("circle")
				    .data(data)
				    .enter()
				    .append("circle")
				    .attr("fill",function(d){
				    	switch(d.continente){
				    		case "europa":
				    			return "#f3a1a0";
				    		case "america":
				    			return "#958e4a";
				    		case "asia":
				    			return "#ac9597";
				    	}
				    })
				    .attr("cx", function(d) {
	    				return xScale(d.datos[0].poblacion)-padding/2;
	    			})
					.attr("cy", function(d) {
					    return yScale(d.datos[0].riqueza);
					})
					.attr("r", function(d) {
	    				return rScale(d.datos[0].poblacion);
	    			});
					
		    	var texts = svg.selectAll("text")
					.attr("class","nombres")
				    .data(data)
				    .enter()
				    .append("text")
					.attr("x", function(d) {
	    				return xScale(d.datos[0].poblacion)+padding/10;
					})
					.attr("y", function(d) {
	    				return yScale(d.datos[0].riqueza)-padding/3;
	    			})
	    			.text(function(d) {
					    return d.nombre;
					})
					.attr("font-family", "sans-serif")
					.attr("font-size", "11px")
					.attr("fill", "#fffbf1");

		    	svg
			    	.append("g")
			    	.attr("class", "axis")
			    	.attr("transform", "translate(0,"+(h-padding)+")")
					.attr("fill","#fffbf1")
			    	.call(xAxis);
			    svg
			    	.append("g")
			    	.attr("class", "axis")
			    	.attr("transform", "translate("+padding+",0)")
					.attr("fill","#fffbf1")
			    	.call(yAxis); 
  
			    svg
				    .append("text")
		            .attr("text-anchor", "middle")  // this makes it easy to centre the text as the transform is applied to the anchor
		            .attr("transform", "translate("+ (padding/4) +","+(h/2)+")rotate(-90)")  // text is drawn off the screen top left, move down and out and rotate
		            .attr("font-size", "10px")
					.attr("fill","#fffbf1")
		            .text("Riqueza");

		        svg
		        	.append("text")
		            .attr("text-anchor", "middle")  // this makes it easy to centre the text as the transform is applied to the anchor
		            .attr("transform", "translate("+((padding+w)/2)+","+(h-(padding/4))+")")  // centre below axis
		            .attr("font-size", "10px")
					.attr("fill","#fffbf1")
		            .text("Poblacion");
				
				svg
					.append("text")
					.attr("id","year")
					.text(data[0].datos[0].year)
					.attr("x", padding*10+60)
					.attr("y", padding+10);
					
				var button = d3.select(".myButton");
				
				button
					.on("click",function(){
						i_circle = 0;
						i_text = 0;
						transitions();
					});
						
				function transitions(){
					
					var circles = svg.selectAll("circle");
					var texts = svg.selectAll("text").data(data);
					var year = svg.select("#year");
					
					i_circle = 2;
					i_text = 2;
					i_year = 2;
					j_circle = 2 * nElem;
					j_text = 2 * nElem;
					
					circles.transition()
						.attr("cx", function(d) {
							return xScale(d.datos[1].poblacion)-padding/2;
						})
						.attr("cy", function(d) {
							return yScale(d.datos[1].riqueza);
						})
						.attr("r", function(d) {
							return rScale(d.datos[1].poblacion);
						})
						.duration(1000)
						.delay(100)
						.each("end",repeatCircles);
					
					texts.transition()
						.attr("x", function(d) {
							return xScale(d.datos[1].poblacion)+padding/10;
						})
						.attr("y", function(d) {
							return yScale(d.datos[1].riqueza)-padding/3;
						})
						.duration(1000)
						.delay(100)
						.each("end",repeatText);
						
					year.transition()
						.text(data[0].datos[1].year)
						.duration(1000) // this is 1s
						.delay(100)
						.each("end",repeatYear);
				}
				
				function repeatYear(){
					if(i_year<data[0].datos.length+1){
						if(i_year==data[0].datos.length){
							d3.select(this).transition()
								.text(data[0].datos[0].year)
								.duration(3000) // this is 1s
								.delay(100);
							i_year++;
						}
						else{
							d3.select(this).transition()
								.text(data[0].datos[i_year].year)
								.duration(1000) // this is 1s
								.delay(100)
								.each("end",repeatYear);
							i_year++;
						}
					}
				}
				
				function repeatText(){
					i_text = parseInt(j_text/nElem);
					if(i_text<data[0].datos.length+1){
						if(i_text==data[0].datos.length){
							d3.select(this).transition()
								.attr("x", function(d) {
									return xScale(d.datos[0].poblacion)+padding/10;
								})
								.attr("y", function(d) {
									return yScale(d.datos[0].riqueza)-padding/3;
								})
								.duration(3000)
								.delay(100);
							j_text++;
						}
						else{
							d3.select(this).transition()
								.attr("x", function(d) {
									return xScale(d.datos[i_text].poblacion)+padding/10;
								})
								.attr("y", function(d) {
									return yScale(d.datos[i_text].riqueza)-padding/3;
								})
								.duration(1000)
								.delay(100)
								.each("end",repeatText);
							j_text++;
						}
					}
				}
				
				
				function repeatCircles(){
					i_circle = parseInt(j_circle/nElem);
					console.log(i_circle);
					if(i_circle<data[0].datos.length+1){
						if(i_circle==data[0].datos.length){
							d3.select(this).transition()
								.attr("cx", function(d) {
									return xScale(d.datos[0].poblacion)-padding/2;
								})
								.attr("cy", function(d) {
									return yScale(d.datos[0].riqueza);
								})
								.attr("r", function(d) {
									return rScale(d.datos[0].poblacion);
								})
								.duration(3000)
								.delay(100);
							j_circle++;
						}
						else{
							d3.select(this).transition()
								.attr("cx", function(d) {
									return xScale(d.datos[i_circle].poblacion)-padding/2;
								})
								.attr("cy", function(d) {
									return yScale(d.datos[i_circle].riqueza);
								})
								.attr("r", function(d) {
									return rScale(d.datos[i_circle].poblacion);
								})
								.duration(1000)
								.delay(100)
								.each("end",repeatCircles);
							j_circle++;
						}
					}
				}
			}
			
			var h_leyenda = h/2;
			
			var svg_leyenda = div
				.append("svg")
				.attr("width", w)
		        .attr("height", h_leyenda)
				.attr("class","leyenda");
			svg_leyenda
				.append("rect")
				.attr("x",padding)
				.attr("y",padding)
				.attr("width", 20)
			    .attr("height", 10)
    			.attr("fill", "#ac9597");
			svg_leyenda
				.append("rect")
				.attr("x",padding)
				.attr("y",padding*2)
				.attr("width", 20)
			    .attr("height", 10)
				.attr("fill", "#f3a1a0");
			svg_leyenda
				.append("rect")
				.attr("x",padding)
				.attr("y",padding*3)
				.attr("width", 20)
			    .attr("height", 10)
				.attr("fill", "#958e4a");
			svg_leyenda
				.append("text")
				.attr("x", padding*2)
				.attr("y", padding+10)
		        .attr("font-size", "10px")
				.attr("fill","#fffbf1")
		        .text("Asia");
			svg_leyenda
				.append("text")
				.attr("x", padding*2)
				.attr("y", padding*2+10)
		        .attr("font-size", "10px")
				.attr("fill","#fffbf1")
		        .text("Europa");
			svg_leyenda
				.append("text")
				.attr("x", padding*2)
				.attr("y", padding*3+10)
		        .attr("font-size", "10px")
				.attr("fill","#fffbf1")
		        .text("America");
		</script>
        <div id="footer">
			<p> Alejandro Cortes Cabrejas</p>
			<p> Follow him on gitHub as @Calexx</p>
		</div>
	</body>
</html>
	